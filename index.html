<!-- CLOAKER SHOPIFY FAKE FRONT - REAL API CONECTADA -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loja Disfar√ßada</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <div id="root">
    <h1 id="headline">Carregando loja...</h1>
    <div id="products"></div>
  </div>

  <script>
    const SHOPIFY_ENDPOINT = 'https://1a20e3-ss.myshopify.com/api/2024-01/graphql.json';
    const SHOPIFY_TOKEN = 'a58a35a5ab9089d8068d6942a4cb77b1';

    async function fetchProducts() {
      const query = `{
        products(first: 6) {
          edges {
            node {
              title
              description
              images(first: 1) {
                edges {
                  node {
                    url
                  }
                }
              }
              variants(first: 1) {
                edges {
                  node {
                    price
                  }
                }
              }
            }
          }
        }
      }`;

      const res = await fetch(SHOPIFY_ENDPOINT, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Shopify-Storefront-Access-Token': SHOPIFY_TOKEN
        },
        body: JSON.stringify({ query })
      });

      const json = await res.json();
      return json.data.products.edges.map(edge => edge.node);
    }

    async function detectarRegiaoEExibirProdutos() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const geo = await res.json();
        const isMobile = /mobile|iphone|android/i.test(navigator.userAgent);
        const isFranca = geo.country === 'FR';

        const produtos = await fetchProducts();
        const container = document.getElementById('products');

        document.getElementById('headline').innerText =
          isFranca && isMobile ? 'üå± Loja de Plantas (FR/Mobile)' : 'üß± Loja de Tijolos (Outros)';

        produtos.forEach(p => {
          const img = p.images.edges[0]?.node?.url || '';
          const price = p.variants.edges[0]?.node?.price || '---';

          container.innerHTML += `
            <div style="border:1px solid #ccc;padding:10px;margin:10px">
              <img src="${img}" width="150" /><br>
              <strong>${p.title}</strong><br>
              <span>‚Ç¨ ${price}</span>
            </div>
          `;
        });
      } catch (err) {
        document.getElementById('headline').innerText = 'Erro ao carregar produtos.';
        console.error(err);
      }
    }

    detectarRegiaoEExibirProdutos();
  </script>
</body>
</html>